# Cleanup Script

## Purpose

The `cleanup.sh` script is designed to clean up files and directories within a specified directory. It recursively deletes files older than a specified number of days and removes any empty directories. This script can be scheduled to run automatically using cron jobs.

## Features

- Deletes files older than a specified number of days.
- Removes empty directories.
- Supports configurable log output: syslog or terminal.
- Can target only subdirectories that match a wildcard pattern via `-w`.
- Can skip empty-directory deletion when `-k` is supplied.
- Dry run modes to preview deletions (`-d` and `-D`).
- Retention period is configurable via `-n` option (default: 180 days).
- Optional compressed archive of deleted files, saved either in the target directory or in a custom location.
- Install and uninstall scripts for easy setup and removal.
- Automatically configures log rotation if terminal logging is selected.

## Usage

### Script Usage

```bash
cleanup.sh [-p directory] [-n days] [-w pattern] [-k] [-l] [-d] [-D] [-z] [-o archive_directory]
```

- `-p directory`: The directory to clean (default: `/var/spool/asterisk/monitor`).
- `-n days`: Number of days to keep files (default: `180`).
- `-w pattern`: Only clean subdirectories matching this wildcard pattern (default: `*`, which means every directory beneath `-p`).
- `-k`: Keep empty directories instead of removing them after file cleanup.
- `-l`: Log actions to syslog. If not specified, output is printed to terminal.
- `-d`: Dry run mode. Instead of deleting files, print how many files (and empty directories) would be removed per target directory.
- `-D`: Detailed dry run. Implies `-d` and lists every file and empty directory that would be deleted without removing them.
- `-z`: Create a compressed tar archive containing every deleted file. The archive is stored at the top of the working directory unless `-o` is provided.
- `-o archive_directory`: Store the archive generated by `-z` in the specified directory instead of the working directory. Supplying this option implies `-z`.

### Examples

Using default values:
```bash
./cleanup.sh
```

Specifying custom values:
```bash
./cleanup.sh -p /path/to/directory -n 30
```

Only clean directories that match a pattern:
```bash
./cleanup.sh -w 'ABC*'
```

Keep empty directories after removing files:
```bash
./cleanup.sh -k
```

Logging actions to syslog:
```bash
./cleanup.sh -l
```

Preview how many files/empty directories would be deleted without deleting them:
```bash
./cleanup.sh -d
```

List every file that would be removed without deleting it:
```bash
./cleanup.sh -D
```

Archive deleted files in the working directory (default location):
```bash
./cleanup.sh -z
```

Archive deleted files to a custom directory:
```bash
./cleanup.sh -z -o /var/backups
```

## Installation

Use the provided `install_cleanup.sh` script to install `cleanup.sh`, choose logging method, set retention period, and configure a cron job.

### Running the Installation Script

1. Save the installation script to a file, for example, `install_cleanup.sh`.
2. Make the script executable:
   ```bash
   chmod +x install_cleanup.sh
   ```
3. Run the script:
   ```bash
   ./install_cleanup.sh
   ```

### What the installer does:
- Installs `cleanup.sh` to `/usr/local/bin`.
- Prompts for time of day to run.
- Asks how many days of files to retain (default: 180).
- Prompts for logging method:
   - **Syslog**: Passes `-l` to script; cron output is discarded.
   - **Terminal**: Redirects output to `/var/log/cleanup.log` and creates a logrotate config at `/etc/logrotate.d/cleanup_log`.
- Adds or replaces the cron job.

## Uninstallation

Use the provided `uninstall_cleanup.sh` script to remove `cleanup.sh`, its cron job, and the logrotate configuration (if created).

### Running the Uninstallation Script

1. Save the uninstallation script to a file, for example, `uninstall_cleanup.sh`.
2. Make the script executable:
   ```bash
   chmod +x uninstall_cleanup.sh
   ```
3. Run the script:
   ```bash
   ./uninstall_cleanup.sh
   ```

### What the uninstaller does:
- Removes `/usr/local/bin/cleanup.sh`.
- Removes any related cron job.
- Deletes `/etc/logrotate.d/cleanup_log` if it exists.

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

## Acknowledgments

This project was assisted by ChatGPT, a language model developed by OpenAI.

